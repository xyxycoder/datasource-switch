<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.app.mapper.InfoMapper">




 <select id="selectAllInfo" resultType="com.app.entity.CardRecord">
		select top 100
		GenTime 'genTime',
		       SeqID 'sqlId',
		       Type1 'type1',
		       TypeName 'typeName',
		       Param1 'param1',
		       StateName 'stateName',
		       Param2 'param2',
		       DevicesName 'devicesName',
		       SitName 'sitName',
		       CardNumber 'cardNumber',
		       AcctName 'acctName',
		       UserName 'userName',
		       OperatorName 'operatorName'
		       from cardrecord
		</select>
	
	
	<select id="selectInfoByTime" resultType="com.app.entity.CardRecord" parameterType="String">
		select top 100
		GenTime 'genTime',
		       SeqID 'sqlId',
		       Type1 'type1',
		       TypeName 'typeName',
		       Param1 'param1',
		       StateName 'stateName',
		       Param2 'param2',
		       DevicesName 'devicesName',
		       SitName 'sitName',
		       CardNumber 'cardNumber',
		       AcctName 'acctName',
		       UserName 'userName',
		       OperatorName 'operatorName'
		       from cardrecord where GenTime>#{genTime}
		</select> 
	<!--	<select id="selectInfoByTime" resultType="com.app.entity.CardRecord" parameterType="String">
			SELECT   top 100
	History.GenTime as 'genTime',
	History.SeqID as 'seqId',
	History.Type1 as 'type1',
	case when History.Type1 = '11'
	then '警报确认'
	when History.Type1 = '12'
	then '警报清除'
	when History.Type1 = '10'
	then '报警消息'
	else 
		CodeMaster.TypeName  end as 'typeName',
	History.Param1 as 'param1',
	case when History.Type1 = '11'
	then ''
	when History.Type1 = '12'
	then ''
	when History.Type1 = '10'
	then ''
	else 
	CodeMaster.Name  end as 'stateName',
	History.Param2 as 'param2',
	HWIndependentDevices. Name as 'devicesName',
	aa.Name as 'sitName',
	History.Param3 as 'cardNumber',
	Account.AcctName as 'acctName',
	CardHolder.LastName + CardHolder.FirstName as 'userName',
	case when OPERATOR.OperatorName IS NULL then '系统'
	else OPERATOR .OperatorName end 'operatorName'
FROM
	(
		(
			History
			LEFT JOIN HWIndependentDevices ON History.Link1 = HWIndependentDevices.DeviceID
			left join (select  ControlTreeEx.RecordID,substring(ControlTreeEx.Name,0,4) shortName,ControlTreeEx.Name from 

ControlTreeEx where ControlTreeEx.Deleted='0' and ControlTreeEx.NodeClass='7000') aa on  charindex(aa.shortName, HWIndependentDevices.Name)!=0
		)
		LEFT JOIN CardHolder ON History.Link3 = CardHolder.RecordID
	)
LEFT JOIN OPERATOR ON History.Link4 = OPERATOR .RecordID
left join Account on Account.RecordID = History.AccountID
left join CodeMaster on History.Type1 = CodeMaster.Type1 and History.Param1 = CodeMaster.param1
WHERE
	History.GenTime &gt; #{genTime}
AND History.GenTime &lt;  (select CONVERT(varchar,GETDATE(),120))
AND (
	(
		History.Type1 = 1
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 10
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 11
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 12
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR History.Type1 = 2
	OR History.Type1 = 3
	OR History.Type1 = 4
	OR History.Type1 = 5
	OR History.Type1 = 6
	OR History.Type1 = 7
	OR History.Type1 = 20
	OR History.Type1 = 16
	OR History.Type1 = 17
	OR History.Type1 = 18
	OR History.Type1 = 19
	OR (
		History.Type1 = 9
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 13
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 14
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 15
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
)
ORDER BY
	History.GenTime
</select>



<select id="selectAllInfo" resultType="com.app.entity.CardRecord">
	SELECT  top 100
	History.GenTime as 'genTime',
	History.SeqID as 'seqId',
	History.Type1 as 'type1',
	case when History.Type1 = '11'
	then '警报确认'
	when History.Type1 = '12'
	then '警报清除'
	when History.Type1 = '10'
	then '报警消息'
	else 
		CodeMaster.TypeName  end as 'typeName',
	History.Param1 as 'param1',
	case when History.Type1 = '11'
	then ''
	when History.Type1 = '12'
	then ''
	when History.Type1 = '10'
	then ''
	else 
	CodeMaster.Name  end as 'stateName',
	History.Param2 as 'param2',
	HWIndependentDevices. Name as 'devicesName',
	aa.Name as 'sitName',
	History.Param3 as 'cardNumber',
	Account.AcctName as 'acctName',
	CardHolder.LastName + CardHolder.FirstName as 'userName',
	case when OPERATOR.OperatorName IS NULL then '系统'
	else OPERATOR .OperatorName end 'operatorName'
FROM
	(
		(
			History
			LEFT JOIN HWIndependentDevices ON History.Link1 = HWIndependentDevices.DeviceID
			left join (select  ControlTreeEx.RecordID,substring(ControlTreeEx.Name,0,4) shortName,ControlTreeEx.Name from 

ControlTreeEx where ControlTreeEx.Deleted='0' and ControlTreeEx.NodeClass='7000') aa on  charindex(aa.shortName, HWIndependentDevices.Name)!=0
		)
		LEFT JOIN CardHolder ON History.Link3 = CardHolder.RecordID
	)
LEFT JOIN OPERATOR ON History.Link4 = OPERATOR .RecordID
left join Account on Account.RecordID = History.AccountID
left join CodeMaster on History.Type1 = CodeMaster.Type1 and History.Param1 = CodeMaster.param1
WHERE History.GenTime &lt; (select CONVERT(varchar,GETDATE(),120))
AND (
	(
		History.Type1 = 1
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 10
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 11
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR (
		History.Type1 = 12
		AND History.Param1 IN (
			1,
			9,
			11,
			5,
			57,
			2,
			3,
			4,
			10,
			12,
			597,
			598,
			585,
			586,
			583,
			584,
			587,
			588,
			550,
			551,
			552,
			553,
			554,
			555,
			556,
			557,
			558,
			559,
			560,
			561,
			562,
			563,
			564,
			565,
			566,
			567,
			568,
			569,
			570,
			571,
			572,
			573,
			574,
			575,
			576,
			577,
			578,
			368,
			369,
			370,
			371,
			372,
			373,
			374,
			375,
			376,
			377,
			378,
			379,
			380,
			381,
			382,
			383,
			384,
			385,
			386,
			387,
			388,
			389,
			390,
			391,
			392,
			393,
			394,
			395,
			396,
			397,
			398,
			399,
			400,
			401,
			402,
			403,
			404,
			405,
			406,
			407,
			408,
			409,
			410,
			411,
			412,
			413,
			414,
			415,
			416,
			417,
			418,
			419,
			420,
			421,
			422,
			423,
			424,
			425,
			426,
			427,
			428,
			429,
			430,
			431,
			432,
			433,
			434,
			435,
			436,
			437,
			438,
			439,
			440,
			441,
			442,
			443,
			444
		)
	)
	OR History.Type1 = 2
	OR History.Type1 = 3
	OR History.Type1 = 4
	OR History.Type1 = 5
	OR History.Type1 = 6
	OR History.Type1 = 7
	OR History.Type1 = 20
	OR History.Type1 = 16
	OR History.Type1 = 17
	OR History.Type1 = 18
	OR History.Type1 = 19
	OR (
		History.Type1 = 9
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 13
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 14
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
	OR (
		History.Type1 = 15
		AND History.Param1 IN (
			1,
			30,
			2,
			110,
			111,
			112,
			113,
			114,
			115,
			116,
			117,
			118,
			119,
			120,
			3,
			26,
			4,
			32,
			5,
			6,
			8,
			33,
			210,
			211,
			212,
			214,
			217,
			218,
			219,
			223,
			224,
			225,
			25,
			27,
			28,
			29,
			31,
			124,
			34,
			35,
			36,
			37,
			38,
			39,
			40
		)
	)
)
ORDER BY
	History.GenTime
</select>  -->
</mapper>
